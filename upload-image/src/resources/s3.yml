Resources:
  MealImageBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: ${self:service}-${self:provider.stage}-meal-image-bucket
      PublicAccessBlockConfiguration:
        BlockPublicAcls: FALSE
        BlockPublicPolicy: FALSE
        IgnorePublicAcls: FALSE
        RestrictPublicBuckets: FALSE

  MealImageBucketPolicy:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket: 
        Ref: MealImageBucket
      PolicyDocument:
        Id: MealImageBucketPolicy
        Statement:
          - Sid: Allow-lambda-PutObject
            Effect: Allow
            Principal: '*'
            Action:
              - s3:PutObject
              - s3:PutObjectAcl
              - s3:GetObject
              - s3:GetObjectAcl
            Resource:
              Fn::Sub:
                - arn:aws:s3:::${bucket}/*
                - bucket: 
                    Ref: MealImageBucket